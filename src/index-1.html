<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="./styles/main.min.css">
</head>

<body>

	<div class="custom-video">
		<video class="custom-video__elements" poster="./img/two_families_mafia-x-men_el.jpg" preload="metadata" playsinline controls muted autoplay>
			<track kind="subtitles" src="./vtt/two_families_mafia-x-men_el-ru.vtt" srclang="ru" default label="Русский">
			<track kind="subtitles" src="./vtt/two_families_mafia-x-men_el-en.vtt" srclang="en" label="English">
			<source src="./video/two_families_mafia-x-men_el.webm" type="video/webm">
			<source src="./video/two_families_mafia-x-men_el.mp4" type="video/mp4">
		</video>

		<button type="button" class="custom-video__start hidden">
			<span class="visually-hidden">play</span>
		</button>

		<div class="custom-video__controls">
			<label class="visually-hidden" for="range-times">current times</label>
			<input id="range-times" class="custom-video__range custom-video__range-elements" type="range" name="range-times" min="0" value="0">

			<button type="button" class="custom-video__button custom-video__play-pause">
				<span class="visually-hidden">play/pause</span>
			</button>

			<p class="custom-video__range-times">
				<span class="custom-video__range-after"></span> / <span class="custom-video__range-before"></span>
			</p>

			<p class="custom-video__sound">
				<button type="button" class="custom-video__button custom-video__sound-button">
					<span class="visually-hidden">muted/unmuted</span>
				</button>
				<label for="sound-range" class="visually-hidden">volume level</label>
				<input type="range" name="sound-range" id="sound-range" class="custom-video__range custom-video__sound-range" min="0" max="1" step="0.01" value="1">
			</p>

			<button type="button" class="custom-video__button custom-video__fullscreen">
				<span class="visually-hidden">fullscreen</span>
			</button>

			<button type="button" class="custom-video__button custom-video__settings">
				<span class="visually-hidden">settings</span>
			</button>

			<ul class="custom-video__list-settings">
				<li class="custom-video__item-settings custom-video__item-settings--speed">
					<label for="speed-range" class="custom-video__speed-label">Скорость: <span>1</span></label>
					<input type="range" name="speed-range" id="speed-range" class="custom-video__range custom-video__speed-range" min="0.1" max="3" step="0.1" value="1">
				</li>
				<li class="custom-video__item-settings">
					<a href="./video/two_families_mafia-x-men_el.mp4" download class="custom-video__button-settings custom-video__download">
						Скачать
					</a>
				</li>
				<li class="custom-video__item-settings">
					<button type="button" class="custom-video__button-settings custom-video__button-cc">
						Субтитры
					</button>
				</li>
			</ul>
		</div>
	</div>

	<script>
		const customVideo = document.querySelector('.custom-video');
		const video = customVideo.querySelector('.custom-video__elements');
		const buttonStart = customVideo.querySelector('.custom-video__start');
		const buttonPlayPause = customVideo.querySelector('.custom-video__play-pause');
		const rangeTime = customVideo.querySelector('.custom-video__range-elements');
		const timeBefore = customVideo.querySelector('.custom-video__range-before');
		const timeAfter = customVideo.querySelector('.custom-video__range-after');
		const fullscreen = customVideo.querySelector('.custom-video__fullscreen');
		const buttonSound = customVideo.querySelector('.custom-video__sound-button');
		const rangeSound = customVideo.querySelector('.custom-video__sound-range');
		const soundDownload = customVideo.querySelector('.custom-video__download');
		const buttonCC = customVideo.querySelector('.custom-video__button-cc');
		const labelSpeed = customVideo.querySelector('.custom-video__speed-label span');
		const rangeSpeed = customVideo.querySelector('.custom-video__speed-range');
		const buttonSettings = customVideo.querySelector('.custom-video__settings');

		video.controls = false;

		const toggleMutted = () => {
			video.muted = !video.muted;
		}

		const handleButtonStart = () => {
			buttonStart.removeEventListener('click', handleButtonStart);
			buttonStart.classList.add('hidden');
			toggleMutted();
		}

		if (video.muted && video.autoplay && buttonStart) {
			buttonStart.classList.remove('hidden');
			buttonStart.addEventListener('click', handleButtonStart);
		}

		const msToTime = (duration) => {
			let seconds = Math.floor((duration / 1000) % 60);
			let minutes = Math.floor((duration / (1000 * 60)) % 60);
			let hours = Math.floor((duration / (1000 * 60 * 60)) % 24);
			hours = (hours < 10) ? "0" + hours : hours;
			minutes = (minutes < 10) ? "0" + minutes : minutes;
			seconds = (seconds < 10) ? "0" + seconds : seconds;
			return hours + ":" + minutes + ":" + seconds;
		}

		const setDuration = () => {
			rangeTime.setAttribute("max", video.duration);
			timeAfter.innerText = msToTime(0);
			timeBefore.innerText = msToTime(video.duration * 1000);
		}

		const handleLoadedMetaData = () => {
			setDuration();
		}

		video.addEventListener("loadedmetadata", handleLoadedMetaData);

		const handleTimeUpdate = () => {
			if (!rangeTime.getAttribute("max")) {
				setDuration();
			}

			rangeTime.value = video.currentTime;
			timeAfter.innerText = msToTime(video.currentTime * 1000);
		}

		video.addEventListener("timeupdate", handleTimeUpdate);

		const handleRangeTime = () => {
				// если пользователь меняет значение рейнджа
				// меняем время и у видео

				video.currentTime = +rangeTime.value;
			}

			rangeTime.addEventListener('input', handleRangeTime);
	</script>
</body>

</html>
